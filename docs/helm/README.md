# Alfresco Content Services Helm Deployment

This page describes how to deploy Alfresco Content Services (ACS) using [Helm](https://helm.sh).

The system deployed is shown in the diagram below.

![Helm Deployment Components](/docs/diagrams/helm-chart/helm-components.png)

## Components

TODO

## Considerations

Alfresco provides tested Helm charts as a "deployment template" for customers who want to take advantage of the container orchestration benefits of Kubernetes. These Helm charts are undergoing continual development and improvement, and should not be used "as is" for your production environments, but should help you save time and effort deploying Alfresco Content Services for your organisation.

The Helm charts in this repository provide a PostgreSQL database in a Docker container and do not configure any logging. This design has been chosen so that they can be installed in a Kubernetes cluster without changes and are still flexible to be adopted to your actual environment. 

For your environment, you should use these charts as a starting point and modify them so that ACS integrates into your infrastructure. You typically want to remove the PostgreSQL container and connect the cs-repository directly to your database (might require custom images to get the required JDBC driver in the container).

Another typical change would be the integration of your company-wide monitoring and logging tools.

## Prerequisites

* AWS EKS Cluster
* Kubectl 
* Helm

## Deploy

For the best results we recommend deploying ACS to AWS EKS following these steps. If you have a machine with at least 16GB of memory you can also deploy using Docker for Desktop.

There are also several examples showing how to deploy with various configurations i.e. using an external database.

## Configure

TODO

## Cleanup

TODO

## Troubleshooting

### Viewing Log Files

TODO

### Changing Log Levels

* The log levels for the specific Java packages in _content-repository_ can be changed via _Admin console_. Use the following URL to access it:
```
https://<host>/alfresco/service/enterprise/admin/admin-log-settings
```
*Note* Changes are applied only to one _content-repository_ node where the Admin console is launched.

* The log levels can be changed by modifying _log4j.properties_ in the _content-repository_ image and doing a rolling update to the deployment. In this case the settings will be applied system wide. See [customization guidelines](customising-deployment.md#k8s-deployment-customization-guidelines).

*WARNING*
 
ACS deployment does not include any log aggregation tools. The logs generated by pods will be lost once the pods are terminated.

### Port-Forwarding To A Pod

This approach allows to connect to a specific application in the cluster.
See [kubernetes documentation](https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster) for details.

Any component of the deployment that is not exposed via ingress rules can be accessed in this way, for example Alfresco Search, DB or individual transformers.

### JMX Dump

This tool allows you to download a ZIP file containing information useful for troubleshooting and supporting your system. Issue a GET request (Admin only) to 
```
https://<host>/alfresco/service/api/admin/jmxdump
```