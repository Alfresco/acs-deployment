name: rafal-test

on:
  pull_request:
  push:
jobs:
  helm_test:
    runs-on: ubuntu-latest
    env:
        HOSTED_ZONE: dev.envalfresco.com
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      #- uses: Alfresco/alfresco-build-tools/.github/actions/setup-aws-cli@OPSEXP-1221-aws
      - uses: unfor19/install-aws-cli-action@v1
        with:
          version: 2.4.25
      - uses: Alfresco/alfresco-build-tools/.github/actions/setup-rancher-cli@master
        with:
          url: ${{ secrets.RANCHER2_URL }}
          access-key: ${{ secrets.RANCHER2_ACCESS_KEY }}
          secret-key: ${{ secrets.RANCHER2_SECRET_KEY }}
          context: local

      - name: Setup kubeconfig
        run: |
            mkdir -p $HOME/.kube && rancher cluster kubeconfig acs-cluster > $HOME/.kube/config
      - uses: azure/setup-kubectl@v2.0
        id: install
      #- uses: Alfresco/alfresco-build-tools/.github/actions/setup-kubectl@OPSEXP-1221-kubectl
      - name: Dummy step
        run: |
            kubectl get pods -A
            docker
            docker-compose --version
            helm
      - name: try to run script
        run: .github/workflows/test.sh
        shell: bash
