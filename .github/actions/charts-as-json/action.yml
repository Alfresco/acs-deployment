---
name: charts_json
description: |
  Return as JSON representation of all the charts and their values files so it's
  easy to build a dynamic workflow matrix
inputs:
  charts-root:
    required: true
    description: root directory containing the charts
  charts-filter:
    required: false
    description: filter to apply to charts, e.g. "acs-sso-example" or "alfresco-content-services"
  values-filter:
    required: false
    description: filter to apply to values files, e.g. "community_values.yaml"
outputs:
  all:
    description: matrix object charts
    value: ${{ steps.getcharts.outputs.all }}
runs:
  using: composite
  steps:
    - id: getcharts
      name: Get main Charts and parse manifest
      run: |
        CHART_FILTER="${{ inputs.charts-filter }}"
        VALUES_FILTER="${{ inputs.values-filter }}"
        
        FILTER_ARGS=""
        [[ -n "$CHART_FILTER" ]] && FILTER_ARGS="$FILTER_ARGS --chart-filter $CHART_FILTER"
        [[ -n "$VALUES_FILTER" ]] && FILTER_ARGS="$FILTER_ARGS --values-filter $VALUES_FILTER"
        
        OUTPUT=$(python3 ${{ github.action_path }}/charts_parser.py "${{ inputs.charts-root }}" $FILTER_ARGS)
        echo "all=$OUTPUT" >> $GITHUB_OUTPUT
      shell: bash
