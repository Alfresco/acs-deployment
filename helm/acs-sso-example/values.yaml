# Default values for acs-sso-example.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  # -- list of trusted URLs.
  # URLs a re used to configure Cross-origin protections
  # Also the first entry is considered the main hosting domain of the platform.
  known_urls:
    - http://localhost

repository-database:
  nameOverride: repository-database
  auth:
    database: alfresco
    username: alfresco
    password: alfresco
  primary:
    persistence:
      enabled: false
    extendedConfiguration: |
      max_connections = 150
      shared_buffers = 512MB
      effective_cache_size = 2GB
      wal_level = minimal
      max_wal_senders = 0
      max_replication_slots = 0
      log_min_messages = LOG
    resources:
      requests:
        cpu: 250m
        memory: 1Gi
      limits:
        cpu: "4"
        memory: 4Gi

keycloakx:
  nameOverride: keycloak
  admin:
    # -- Keycloak admin username
    username: admin
    # -- Keycloak admin password
    # -- @default randomly generated on first deployment get value using:
    # kubectl get secrets keycloak -o jsonpath='{@.data.KEYCLOAK_ADMIN_PASSWORD}' | base64 -d
    password: null
    realm:
      - id: alfresco
        realm: alfresco
        enabled: true
        sslRequired: none
        loginTheme: alfresco
        clients:
          - clientId: alfresco
            enabled: true
            standardFlowEnabled: true
            implicitFlowEnabled: true
            publicClient: true
            redirectUris:
              - http://localhost/*
            webOrigins:
              - http://localhost
        users:
          - username: admin
            enabled: true
            credentials:
              - type: password
                value: secret
        internationalizationEnabled: true
        defaultLocale: en
        supportedLocales:
          - "ca"
          - "de"
          - "en"
          - "es"
          - "fr"
          - "it"
          - "ja"
          - "lt"
          - "nl"
          - "no"
          - "pt-BR"
          - "ru"
          - "sv"
          - "zh-CN"
  command:
    - /opt/keycloak/bin/kc.sh
    - start
    - --http-enabled=true
    - --http-port=8080
    - --hostname-strict=false
    - --hostname-strict-https=false
    - --import-realm
  http:
    relativePath: /auth
  ingress:
    enabled: true
    tls: []
    rules:
      - host: localhost
        paths:
          - path: "{{ .Values.http.relativePath }}"
            pathType: Prefix
  extraEnvFrom: |
    - configMapRef:
        name: keycloak
    - secretRef:
        name: keycloak
  extraEnv: |
    - name: JAVA_OPTS_APPEND
      value: >-
        -Djgroups.dns.query={{ include "keycloak.fullname" . }}-headless
  extraVolumeMounts: |
    - name: theme
      mountPath: /opt/keycloak/themes
    - name: realm
      mountPath: /opt/keycloak/data/import
  extraVolumes: |
    - name: theme
      emptyDir: {}
    - name: realm
      secret:
        secretName: keycloak-realm
  extraInitContainers: |
    - image: busybox:1.36
      imagePullPolicy: IfNotPresent
      name: theme-fetcher
      command: [sh]
      args:
        - -c
        - |
          wget https://github.com/Alfresco/alfresco-keycloak-theme/releases/download/0.3.5/alfresco-keycloak-theme-0.3.5.zip -O alfresco.zip
          unzip -d /themes alfresco.zip
      volumeMounts:
        - name: theme
          mountPath: /themes

activemq:
  nameOverride: activemq
  persistence:
    enabled: false
  adminUser:
    user: alfresco
    password: alfresco

alfresco-repository:
  replicaCount: 1
  image:
    repository: alfresco/alfresco-content-repository-community
    tag: 23.2.0-A12
  configuration:
    repository:
      existingConfigMap: repository-properties
    db:
      existingConfigMap:
        name: repository-database
      existingSecret:
        name: repository-database
    messageBroker:
      existingConfigMap:
        name: repository-message-broker
      existingSecret:
        name: repository-message-broker
  ingress:
    hosts:
      - host: localhost
        paths:
          - path: /
            pathType: Prefix
          - path: /api-explorer
            pathType: Prefix

alfresco-share:
  nameOverride: alfresco-share
  image:
    repository: alfresco/alfresco-share
    tag: 23.2.0-A12
  repository:
    existingConfigMap:
      name: share-repository
  extraVolumes:
    - name: share-properties
      configMap:
        name: share-properties
  extraVolumeMounts:
    - name: share-properties
      mountPath: >-
        /usr/local/tomcat/webapps/share/WEB-INF/classes/share-config.properties
      subPath: share.properties
  ingress:
    hosts:
      - host: localhost
        paths:
          - path: /share
            pathType: Prefix

alfresco-content-app:
  nameOverride: alfresco-content-app
  enabled: true
  service:
    envType: frontend
  ingress:
    ingressClassName: nginx
    hostName: localhost
    path: /workspace
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: 5g
      nginx.ingress.kubernetes.io/proxy-buffer-size: 8k
    tls: []
  image:
    repository: alfresco/alfresco-content-app
    tag: 4.3.0
    pullPolicy: IfNotPresent
  env:
    APP_CONFIG_PROVIDER: ECM
    APP_CONFIG_AUTH_TYPE: OAUTH
    API_URL: "{protocol}//{hostname}{:port}"
    APP_CONFIG_OAUTH2_HOST: "{protocol}//{hostname}{:port}/auth/realms/alfresco"
    APP_CONFIG_OAUTH2_CLIENTID: alfresco
    APP_CONFIG_OAUTH2_REDIRECT_SILENT_IFRAME_URI: "{protocol}//{hostname}{:port}/assets/silent-refresh.html"
  securityContext:
    runAsNonRoot: true
    runAsUser: 101
    capabilities:
      drop:
        - NET_RAW
        - ALL
  resources:
    requests:
      cpu: "0.25"
      memory: "256Mi"
    limits:
      cpu: "1"
      memory: "1024Mi"
