apiVersion: v1
kind: ConfigMap
metadata:
  name: repository-database
  labels:
  {{ template "acs-sso-example.labels" . }}
data:
  DATABASE_DRIVER: org.postgresql.Driver
  {{- with (index .Values "repository-database") }}
  {{- $glob := $.Values.global | default dict }}
  {{- $pgglob := $glob | default dict }}
  {{- $pgglob = $pgglob.service | default dict }}
  {{- $pgglob = $pgglob.ports | default dict }}
  {{- $pgport := coalesce $pgglob.postgresql .primary.service.ports.postgresql 5432 }}
  {{- $dbCtx := dict "Values" . "Chart" $.Chart "Release" $.Release }}
  DATABASE_URL: {{ printf "jdbc:postgresql://%s:%v/%s" (include "postgresql.v1.primary.fullname" $dbCtx) $pgport .primary.auth.database | quote }}
  {{- end }}
