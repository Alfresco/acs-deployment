nameOverride: keycloak
image:
  tag: 26.0.7
proxy:
  mode: xforwarded
command:
  - /opt/keycloak/bin/kc.sh
  - start
  - --hostname=http://localhost/auth
  - --hostname-backchannel-dynamic=true
  - --health-enabled=true
  - --http-enabled=true
  - --http-port=8080
  - --import-realm
http:
  relativePath: /auth
livenessProbe: |
  httpGet:
    path: '{{ tpl .Values.http.relativePath $ | trimSuffix "/" }}/health/live'
    port: http-internal
  initialDelaySeconds: 0
  timeoutSeconds: 5
readinessProbe: |
  httpGet:
    path: '{{ tpl .Values.http.relativePath $ | trimSuffix "/" }}/health/ready'
    port: http-internal
  initialDelaySeconds: 10
  timeoutSeconds: 1
startupProbe: |
  httpGet:
    path: '{{ tpl .Values.http.relativePath $ | trimSuffix "/" }}/health'
    port: http-internal
  initialDelaySeconds: 15
  timeoutSeconds: 1
  failureThreshold: 60
  periodSeconds: 5
ingress:
  enabled: true
  ingressClassName: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-buffer-size: 8k
  tls: []
  rules:
    - host: localhost
      paths:
        - path: /auth
          pathType: Prefix
extraEnvFrom: |
  - configMapRef:
      name: keycloak
  - secretRef:
      name: keycloak
extraEnv: |
  - name: JAVA_OPTS_APPEND
    value: >-
      -Djgroups.dns.query={{ include "keycloak.fullname" . }}-headless
extraVolumeMounts: |
  - name: theme
    mountPath: /opt/keycloak/themes
  - name: realm
    mountPath: /opt/keycloak/data/import
extraVolumes: |
  - name: theme
    emptyDir: {}
  - name: realm
    secret:
      secretName: keycloak-realm
extraInitContainers: |
  - image: busybox:1.37
    imagePullPolicy: IfNotPresent
    name: theme-fetcher
    command: [sh]
    args:
      - -c
      - |
        wget https://github.com/Alfresco/alfresco-keycloak-theme/releases/download/0.3.5/alfresco-keycloak-theme-0.3.5.zip -O alfresco.zip
        unzip -d /themes alfresco.zip
    volumeMounts:
      - name: theme
        mountPath: /themes