---
suite: test solr secret
templates:
  - secret-solr.yaml
tests:
  - it: should have basic metadata in place
    values: &testvalues
      - ../../../tests/values/test_values.yaml
    asserts:
      - equal:
          path: metadata.name
          value: RELEASE-NAME-alfresco-search-solr-secret
        template: secret-solr.yaml

  - it: should contains test shared secret by default
    values: *testvalues
    asserts:
      - equal:
          path: data.SOLR_SHARED_SECRET
          value: ZHVtbXk=
        template: secret-solr.yaml
  
  - it: should contains overridden secret
    values: *testvalues
    set:
      global.tracking.sharedsecret: alfresco
    asserts:
      - equal:
          path: data.SOLR_SHARED_SECRET
          value: YWxmcmVzY28=
        template: secret-solr.yaml

  - it: should not have a secret when not enabled
    values: *testvalues
    set:
      global.tracking.auth: none
    asserts:
      - hasDocuments:
          count: 0
        template: secret-solr.yaml
