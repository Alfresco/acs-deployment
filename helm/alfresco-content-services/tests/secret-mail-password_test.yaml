---
suite: test mail password secret manifest
templates:
  - secret-mail-password.yaml
tests:
  - it: should have empty credentials as default
    values: &testvalues
      - values/test_values.yaml
    asserts:
      - hasDocuments:
          count: 0

  - it: should have credentials populated in the secret when enabled
    values: *testvalues
    set:
      email.server.enabled: true
      mail.password: mymailpassword
    asserts:
      - equal:
          path: data.MAIL_PASSWORD
          value: bXltYWlscGFzc3dvcmQ=

  - it: should not have a secret when existingSecretName is set
    values: *testvalues
    set:
      email.server.enabled: true
      mail.existingSecretName: mySecret
    asserts:
      - hasDocuments:
          count: 0
