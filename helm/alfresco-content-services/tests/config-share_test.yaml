---
suite: test share configmap
templates:
  - config-share.yaml
tests:
  - it: should merge proxy property with defined JAVA_OPTS
    values: &testvalues
      - values/test_values.yaml
    set:
      share:
        environment:
          JAVA_OPTS: -Daims.enabled=false
      externalHost: myExternalProxy
      externalPort: 3128
    asserts:
      - equal:
          path: data.JAVA_OPTS
          value: -Daims.enabled=false -Dalfresco.proxy=http://myExternalProxy:3128
      - equal:
          path: data.CATALINA_OPTS
          value: -XX:MinRAMPercentage=50 -XX:MaxRAMPercentage=80

  - it: should render just the proxy with default environment value
    values: *testvalues
    set:
      externalHost: myExternalProxy
      externalPort: 3128
    asserts:
      - equal:
          path: data.JAVA_OPTS
          value: -Dalfresco.proxy=http://myExternalProxy:3128
      - equal:
          path: data.CATALINA_OPTS
          value: -XX:MinRAMPercentage=50 -XX:MaxRAMPercentage=80

  - it: should render just the proxy with empty environment
    values: *testvalues
    set:
      externalHost: myExternalProxy
      externalPort: 3128
      share.environment: null
    asserts:
      - equal:
          path: data.JAVA_OPTS
          value: -Dalfresco.proxy=http://myExternalProxy:3128
      - isNull:
          path: data.CATALINA_OPTS
