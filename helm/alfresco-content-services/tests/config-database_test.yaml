---
suite: test config-database manifest
templates:
  - config-database.yaml
tests:
  - it: should reference embedded postgres with default values
    values: &testvalues
      - values/test_values.yaml
    asserts:
      - equal:
          path: data.DATABASE_URL
          value: jdbc:postgresql://RELEASE-NAME-postgresql-acs:5432/alfresco
        template: config-database.yaml

  - it: should reference external postgres when enabled
    values: *testvalues
    set:
      database:
        external: true
        url: jdbc:postgresql://my-external-postgresql-acs:5432/alfresco
    asserts:
      - equal:
          path: data.DATABASE_URL
          value: jdbc:postgresql://my-external-postgresql-acs:5432/alfresco
        template: config-database.yaml
